{% extends "layout/editor.html" %}
{% load static %}

{% block model_menu %}
<li class="nav-item ms-4">
  <div class="btn-group" role="group">
    <button type="button" class="btn btn-sm btn-outline-light border-0"><i class="fas fa-plus"></i></button>
    <button type="button" class="btn btn-sm btn-outline-light border-0"><i class="fas fa-clone"></i></button>
  </div>
</li>
<li class="nav-item" style="margin-left:145px;">
  <form id="script_form" action="{% url 'console' %}" method="POST" autocomplete="off" onsubmit="return submitForm();">
    {% csrf_token %}
    <button type="submit" class="btn btn-sm btn-success border-0" title="Rodar Script"><i class="fas fa-eraser me-2"></i> Run</button>
    <input type="hidden" id="id_script" name="script" value="">
    <input type="hidden" id="id_console" name="console" value="">
  </form>
</li>
<li class="nav-item">
  <div class="btn-group ms-3" role="group">
    <button type="button" class="btn btn-sm btn-outline-light border-0" disabled><i class="fas fa-spell-check"></i></button>
    <a href="{% url 'console' %}" id="clear" class="btn btn-sm btn-outline-light border-0" title="Reiniciar Console"><i class="fas fa-eraser"></i></a>
    <a href="{% url 'index' %}" id="home" class="btn btn-sm btn-outline-warning px-3 border-0 fw-bold" title="Salvar e Fechar">Sair</a>
  </div>
</li>
{% endblock%}

{% block editor %}
<div id="editor"></div>
{% endblock%}

{% block nav_editor %}
<a href="#" class="ps-2 list-group-item list-group-item-action list-group-item-light active d-flex justify-content-between align-items-center">Dot<span><i class="fas fa-trash pointer"></i></span></a>
{% endblock%}

{% block add_script_src %}
<script src="{% static 'js/vendor/ace/ace.js' %}"></script>
{% endblock %}

<script>
  {% block add_script %}
  var SHORTCUT_MAP = {};
  function eventHandler(e){
    {% include '_component/script/global_handler.js' %}
    else{}}
  function submitForm(){
    document.getElementById('id_script').value = editor.getValue();
    document.getElementById('id_console').value = document.getElementById('console_display').innerHTML;
    console.log(document.getElementById('console_display').innerHTML);
    return true;
  }
  // --------------------------------------------------------------------
  var editor = ace.edit("editor");
  editor.setTheme("ace/theme/ambiance");
  editor.session.setMode("ace/mode/text");
  editor.renderer.setScrollMargin(14)
  editor.setShowPrintMargin(false);
  document.getElementById('editor').style.fontSize='0.9rem';
  
  
var rules = editor.session.$mode.$highlightRules.getRules();
for (var stateName in rules) {
    if (Object.prototype.hasOwnProperty.call(rules, stateName)) {
        rules[stateName].unshift(
        {token: 'keyword',regex: '@[A-z-0-9]+'},
        {token: 'variable',regex: '![A-z-0-9,-;]+'},
        {token: 'constant',regex: ':[A-z-0-9,-;=]+'},
        {token: 'string',regex: '#[A-z-0-9]+'},
        {token: 'invalid',regex: '<br>|<hr>'},
        {token: 'comment',regex: '__[A-z0-9À-ú,-; ]+__'},
        {token: 'custom',regex: 'foo'},
      );
    }
}

editor.session.$mode.$tokenizer = null;
editor.session.bgTokenizer.setTokenizer(editor.session.$mode.getTokenizer());
editor.session.bgTokenizer.start(0);
editor.setValue('@alert { #rafael :link=core_usuarios :alert_class_list=text-warning;bg-info}',0);
editor.navigateFileEnd();
editor.focus();

  
{% endblock %}
</script>