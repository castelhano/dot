{% extends "layout/dot.html" %}
{% load static %}
{% block title %}SIT{% endblock %}
{% block model_menu %}{% include "_component/menu/core.html" %}{% endblock%}


<style>
{% block style %}
/* .addOnTarefaSave{padding: 2px 6px;border-radius: 20%;cursor: pointer;background-color: #F1F1F1;color: #333;opacity: 0.7;transition: all 0.5s;}
.addOnTarefaAdd{margin-left: 4px; padding: 2px 6px;border-radius: 20%;cursor: pointer;background-color: #F1F1F1;color: #198754;opacity: 0.7;transition: all 0.5s;} */
/* .addOnTarefaSave:hover,.addOnTarefaAdd:hover{opacity: 1;border-radius: 10%;} */
.loadingWidget{position: absolute;width: 100%;height: 100%;text-align: center;background-color: #FFF;opacity: 0.8;padding-top: 40px;}
.loadingWidget span{display: block;color: #333;}
@media(max-width: 768px){
  /* .addOnTarefaSave, .addOnTarefaAdd{padding: 4px 10px;} */
}
{% endblock%}
</style>

{% block content_fluid %}
<a class="d-none" id="clear" href="{% url 'index' %}"></a>
<div id="dotWidgetsContainer" class="row px-1 pt-lg-2">
  <div id="messages_widget" class="card-widget col-6 col-lg-4 col-xl-2 btn-secondary d-none"><i class="fas fa-inbox lead-image"> <sup id="alertas_badge" style="font-family: var(--bs-body-font-family); font-size:2rem;">0</sup></i><a class="widget-label stretched-link" data-bs-toggle="offcanvas" href="#offcanvas" role="button" title="ALT + M">Notificações<kbd class="float-end fs-9">alt m</kbd></a></div>
  {% if perms.core.console %}<div class="card-widget col-6 col-lg-4 col-xl-2 btn-dark" title="Ctrl + C"><i class="fas fa-window-restore lead-image"></i><a id="console_link" class="widget-label stretched-link" href="{% url 'console' %}">Admin Console</a></div>{% endif %}
  {% if perms.gestao.dashboard %}<div class="card-widget col-6 col-lg-4 col-xl-2 btn-dark" title="Ctrl + C"><i class="fas fa-chart-pie lead-image"></i><a id="widget_action_gestao" class="widget-label stretched-link" href="{% url 'gestao_dashboard' %}">Gerencial<kbd class="float-end fs-9 bg-light text-dark fw-bold">ctrl 1</kbd></a></div>{% endif %}
  {% if perms.core.view_agenda %}<div class="card-widget card-widget-fixed col-12 col-lg-4 col-xl-2 p-0 bg-purple"><div id="loadingScreenAgenda" class="loadingWidget"><div class="spinner-border text-success"></div><span>Carregando Agenda...</span></div><div id="widget_core_agenda" class="h-100 container-fluid px-1"></div></div>{% endif %}
  {% if perms.pessoal.view_funcionario %}<div class="card-widget col-6 col-lg-4 col-xl-2 btn-purple"><i class="fas fa-user-tie lead-image"></i><a id="widget_action_pessoal" class="widget-label stretched-link" href="{% url 'pessoal_funcionarios' %}">Pessoal<kbd class="float-end fs-9">ctrl p</kbd></a></div>{% endif %}
  {% if perms.recrutamento.view_selecao %}<div class="card-widget col-6 col-lg-4 col-xl-2 btn-purple"><i class="fas fa-users lead-image"></i><a id="widget_action_recrutamento" class="widget-label stretched-link" href="{% url 'recrutamento_selecoes' %}">Recrutamento<kbd class="float-end fs-9">ctrl r</kbd></a></div>{% endif %}
  {% if perms.sac.view_reclamacao %}<div class="card-widget col-6 col-lg-4 col-xl-2 btn-purple"><i class="fas fa-headset lead-image"></i><a id="widget_action_sac" class="widget-label stretched-link" href="{% url 'sac_reclamacoes' %}">SAC<kbd class="float-end fs-9">ctrl 2</kbd></a></div>{% endif %}
  {% if perms.oficina.view_frota %}<div class="card-widget col-6 col-lg-4 col-xl-2 btn-success"><i class="fas fa-bus lead-image"></i><a id="widget_action_oficina" class="widget-label stretched-link" href="{% url 'oficina_frotas' %}">Oficina<kbd class="float-end fs-9">ctrl o</kbd></a></div>{% endif %}
  {% if perms.trafego.view_linha %}<div class="card-widget col-6 col-lg-4 col-xl-2 btn-primary"><i class="fas fa-route lead-image"></i><a id="widget_action_linha" class="widget-label stretched-link" href="{% url 'trafego_linhas' %}">Linhas<kbd class="float-end fs-9">ctrl g</kbd></a></div>{% endif %}
  {% if perms.trafego.view_planejamento %}<div class="card-widget col-6 col-lg-4 col-xl-2 btn-primary"><i class="fas fa-random lead-image"></i><a id="widget_action_planejamento" class="widget-label stretched-link" href="{% url 'trafego_planejamentos' %}">Planejamento<kbd class="float-end fs-9">ctrl 3</kbd></a></div>{% endif %}
  {% if perms.trafego.view_notificacao %}<div class="card-widget col-6 col-lg-4 col-xl-2 btn-primary"><i class="fas fa-file-signature lead-image"></i><a id="widget_action_notificacao" class="widget-label stretched-link" href="{% url 'trafego_notificacoes' %}">Notificações</a></div>{% endif %}
  {% if perms.trafego.view_ocorrencia %}<div class="card-widget col-6 col-lg-4 col-xl-2 btn-primary"><i class="fas fa-road lead-image"></i><a id="widget_action_ocorrencia" class="widget-label stretched-link" href="{% url 'trafego_ocorrencias' %}">Ocorrências</a></div>{% endif %}
  {% if perms.sinistro.view_acidente %}<div class="card-widget col-6 col-lg-4 col-xl-2 btn-primary"><i class="fas fa-car-crash lead-image"></i><a id="widget_action_acidente" class="widget-label stretched-link" href="{% url 'sinistro_acidentes' %}">Sinistro<kbd class="float-end fs-9">ctrl k</kbd></a></div>{% endif %}
  {% if perms.globus.view_escala %}<div class="card-widget col-6 col-lg-4 col-xl-2 btn-orange"><i class="fas fa-file-import lead-image"></i><a id="widget_action_globus" class="widget-label stretched-link" href="{% url 'globus_escalas' %}">Escalas (Globus)</a></div>{% endif %}
  {% if perms.globus.consultar_escala %}<div class="card-widget col-6 col-lg-4 col-xl-2 btn-orange"><i class="fas fa-user-clock lead-image"></i><a id="widget_action_consultar_escala" class="widget-label stretched-link" href="{% url 'globus_consultar_escala' %}">Consultar Escala</a></div>{% endif %}
  {% if perms.globus.localizar_escala %}
  <div class="card-widget col-6 col-lg-4 col-xl-2 btn-orange"><i class="fas fa-search lead-image"></i><a id="widget_action_localizar_escala" class="widget-label stretched-link" href="{% url 'globus_localizar_escala' %}">Pesquisa Escala</a></div>
  <div class="card-widget col-6 col-lg-4 col-xl-2 btn-orange"><i class="fas fa-clipboard-list lead-image"></i><a id="widget_action_planejamento_linha" class="widget-label stretched-link" href="{% url 'globus_planejamento_linha' %}">Horários Linha</a></div>
  {% endif %}
</div>
{% endblock%}

{% block offcanvas_body %}
<h6 data-type="dotOffcanvasAncor" class="text-body-secondary mt-3">Configurações:</h6>
<div class="form-check form-switch">
  <input class="form-check-input" type="checkbox" role="switch" name="addOn_agenda" id="id_addOnAgenda" data-model="addOnAgenda" onclick="addOnSettingsChange(this)">
  <label class="form-check-label" for="id_addOnAgenda">Addon: <b class="text-purple">Agenda</b></label>
</div>
<div class="form-check form-switch">
  <input class="form-check-input" type="checkbox" role="switch" name="addOn_tarefas" id="id_addOnTarefas" data-model="addOnTarefas" onclick="addOnSettingsChange(this)">
  <label class="form-check-label" for="id_addOnTarefas">Addon: <b class="text-purple">Tarefas</b></label>
</div>
{% endblock %}

  
{% block add_script_src %}
<script src="{% static 'js/date.js' %}"></script>
<script src="{% static 'js/table.js' %}"></script>
{% if perms.core.view_agenda %}<script src="{% static 'js/calendar.js' %}"></script>{% endif %}
{% endblock %}
<script>
{% block add_script %}
SHORTCUT_MAP['1FTF'] = () => {try{document.getElementById('widget_action_gestao').click()}catch(e){}};
SHORTCUT_MAP['pFTF'] = () => {try{document.getElementById('widget_action_pessoal').click()}catch(e){}};
SHORTCUT_MAP['rFTF'] = () => {try{document.getElementById('widget_action_recrutamento').click()}catch(e){}};
SHORTCUT_MAP['2FTF'] = () => {try{document.getElementById('widget_action_sac').click()}catch(e){}};
SHORTCUT_MAP['oFTF'] = () => {try{document.getElementById('widget_action_oficina').click()}catch(e){}};
SHORTCUT_MAP['gFTF'] = () => {try{document.getElementById('widget_action_linha').click()}catch(e){}};
SHORTCUT_MAP['3FTF'] = () => {try{document.getElementById('widget_action_planejamento').click()}catch(e){}};
SHORTCUT_MAP['kFTF'] = () => {try{document.getElementById('widget_action_acidente').click()}catch(e){}};



{% if perms.core.view_agenda %}

let today = new Date();
let year = today.getFullYear();
let month = today.getMonth() + 1;
let events = {};
let holidays = {};
function getAgenda() {
    return new Promise(function(resolve, reject) {
        var xhr = new XMLHttpRequest();
        xhr.onload = function() {
            let obj = JSON.parse(this.responseText);
            for(item in obj){events[obj[item].fields.data] = 'Eventos: Click para visualizar';}
            resolve(events);
        };
        xhr.onerror = reject;
        xhr.open("GET", `{% url 'core_get_agenda' %}?ano=${year}&mes=${month}`, true);
        xhr.send();
    });
}

function getFeriados() {
    return new Promise(function(resolve, reject) {
        var xhr = new XMLHttpRequest();
        xhr.onload = function() {
            holidays = JSON.parse(this.responseText);
            resolve(holidays);
        };
        xhr.onerror = reject;
        xhr.open("GET", `{% url 'core_get_feriados' %}?ano=${year}`, true);
        xhr.send();
    });
}
getAgenda().then(() => {getFeriados().then(() => {
  const agenda = new jsCalendar({
  container: document.getElementById('widget_core_agenda'),
  holidays: holidays,
  events: events,
  canChangeView: false,
  selectedDays: [dotToday(0,0,0,true)],
  onclick: (day) => {window.location.href = `{% url 'core_agendas' %}?data=${day}`;},
  calendarClasslist: 'table table-sm border caption-top text-center mb-0 user-select-none fs-9',
  captionClasslist: 'py-1',
  headerClasslist: 'border border-light-subtle py-0 bg-light text-body-secondary fs-9',
  customDayClasslist: 'border border-light-subtle py-0 bg-light fs-7',
  holidayClasslist: 'border border-light-subtle py-0 bg-danger-subtle fs-7',
  busyDayClasslist: 'border border-light-subtle py-0 bg-purple-light fs-7',
  emptyDayClasslist: 'border border-light-subtle bg-dark-subtle bg-opacity-50 py-0',
  selectDayClasslist: 'border border-light-subtle py-0 bg-light fw-bold fs-7',
  monthNameClassList: 'mt-0 ps-1 pointer text-light fs-6',
  monthPickerClassList: 'form-select form-select-sm me-1 py-1 fs-9',
  yearPickerClassList: 'form-control form-control-sm me-1 py-0 fs-9',
  calendarControlsChangeViewClasslist: 'btn btn-sm btn-light fs-9 py-1 py-lg-0 me-1',
  calendarControlsCurrentClasslist: 'btn btn-sm btn-light fs-9 py-1 py-lg-0',
  calendarControlsNavegateClasslist: 'btn btn-sm btn-light py-1 py-lg-0 fs-9 ms-1',
  calendarControlsCancelClasslist: 'btn btn-sm btn-light text-body-secondary py-1 me-1 fs-9',
  calendarControlsSelectDayClasslist: 'btn btn-sm btn-light text-success py-1 me-1 fs-9',
});
document.getElementById('loadingScreenAgenda').remove();
})})

{% endif %}



{% include 'core/_addOn.js' %}
{% include '_component/script/update_alertas.js' %}
{% endblock %}
</script>